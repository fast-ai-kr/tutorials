<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Look inside ImageDataLoaders | tutorials from fast.ai KR</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Look inside ImageDataLoaders" />
<meta name="author" content="Chansung Park" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="what is it? what’s in it? Let’s dig more inside of this handy class by looking inside of the actual source code." />
<meta property="og:description" content="what is it? what’s in it? Let’s dig more inside of this handy class by looking inside of the actual source code." />
<link rel="canonical" href="https://fast-ai-kr.github.io/tutorials/image_data_loaders/" />
<meta property="og:url" content="https://fast-ai-kr.github.io/tutorials/image_data_loaders/" />
<meta property="og:site_name" content="tutorials from fast.ai KR" />
<meta property="og:image" content="https://fast-ai-kr.github.io/tutorials/images/from_path_func.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-08T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Chansung Park"},"description":"what is it? what’s in it? Let’s dig more inside of this handy class by looking inside of the actual source code.","@type":"BlogPosting","headline":"Look inside ImageDataLoaders","dateModified":"2020-09-08T00:00:00-05:00","datePublished":"2020-09-08T00:00:00-05:00","url":"https://fast-ai-kr.github.io/tutorials/image_data_loaders/","mainEntityOfPage":{"@type":"WebPage","@id":"https://fast-ai-kr.github.io/tutorials/image_data_loaders/"},"image":"https://fast-ai-kr.github.io/tutorials/images/from_path_func.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/tutorials/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://fast-ai-kr.github.io/tutorials/feed.xml" title="tutorials from fast.ai KR" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-177394312-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/tutorials/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Look inside ImageDataLoaders | tutorials from fast.ai KR</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Look inside ImageDataLoaders" />
<meta name="author" content="Chansung Park" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="what is it? what’s in it? Let’s dig more inside of this handy class by looking inside of the actual source code." />
<meta property="og:description" content="what is it? what’s in it? Let’s dig more inside of this handy class by looking inside of the actual source code." />
<link rel="canonical" href="https://fast-ai-kr.github.io/tutorials/image_data_loaders/" />
<meta property="og:url" content="https://fast-ai-kr.github.io/tutorials/image_data_loaders/" />
<meta property="og:site_name" content="tutorials from fast.ai KR" />
<meta property="og:image" content="https://fast-ai-kr.github.io/tutorials/images/from_path_func.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-08T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Chansung Park"},"description":"what is it? what’s in it? Let’s dig more inside of this handy class by looking inside of the actual source code.","@type":"BlogPosting","headline":"Look inside ImageDataLoaders","dateModified":"2020-09-08T00:00:00-05:00","datePublished":"2020-09-08T00:00:00-05:00","url":"https://fast-ai-kr.github.io/tutorials/image_data_loaders/","mainEntityOfPage":{"@type":"WebPage","@id":"https://fast-ai-kr.github.io/tutorials/image_data_loaders/"},"image":"https://fast-ai-kr.github.io/tutorials/images/from_path_func.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://fast-ai-kr.github.io/tutorials/feed.xml" title="tutorials from fast.ai KR" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-177394312-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<script src="https://hypothes.is/embed.js" async></script>

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/tutorials/">tutorials from fast.ai KR</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/tutorials/about/">About Me</a><a class="page-link" href="/tutorials/search/">Search</a><a class="page-link" href="/tutorials/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Look inside ImageDataLoaders</h1><p class="page-description">what is it? what's in it? Let's dig more inside of this handy class by looking inside of the actual source code.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-09-08T00:00:00-05:00" itemprop="datePublished">
        Sep 8, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Chansung Park</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/tutorials/categories/#image">image</a>
        &nbsp;
      
        <a class="category-tags-link" href="/tutorials/categories/#data">data</a>
        &nbsp;
      
        <a class="category-tags-link" href="/tutorials/categories/#fastai">fastai</a>
        
      
      </p>
    

    
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Why-looking-inside?">Why looking inside? </a></li>
<li class="toc-entry toc-h2"><a href="#Let's-see-the-definition">Let&#39;s see the definition </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Each-methods">Each methods </a></li>
<li class="toc-entry toc-h3"><a href="#Example-usage-with-from_path_func">Example usage with from_path_func </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Let's-look-inside-one-of-them,-from_folder(...)">Let&#39;s look inside one of them, from_folder(...) </a>
<ul>
<li class="toc-entry toc-h3"><a href="#GrandparentSplitter-function">GrandparentSplitter function </a></li>
<li class="toc-entry toc-h3"><a href="#partial(-get_image_files,-folders=[train,-valid]-)">partial( get_image_files, folders=[train, valid] ) </a></li>
<li class="toc-entry toc-h3"><a href="#get_image_files">get_image_files </a></li>
<li class="toc-entry toc-h3"><a href="#DataBlock">DataBlock </a></li>
<li class="toc-entry toc-h3"><a href="#@delegates-decorator">@delegates decorator </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-09-08-ImageDataLoaders.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Why-looking-inside?">
<a class="anchor" href="#Why-looking-inside?" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why looking inside?<a class="anchor-link" href="#Why-looking-inside?"> </a>
</h2>
<p>There is a couple of reasons. First, <code>fastai</code> is a wonderful library. It clearly shows how it works in a high-level view. However, when you want to customize its behaviour, the official document is somewhat limited to understand behind scene. Second, <code>fastai</code> comes along with other awesome libraries such as <code>fastcore</code>. You will find very useful and clever programming usage with them. Also it helps you to have strong programability.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Let's-see-the-definition">
<a class="anchor" href="#Let's-see-the-definition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Let's see the definition<a class="anchor-link" href="#Let's-see-the-definition"> </a>
</h2>
<p>Basic wrapper around several <strong><code>DataLoader</code></strong>s with factory methods for computer vision problems. Don't be bothered by <strong><code>delegates</code></strong> thing for now. I will explain what it is shortly.</p>
<p>In a nutshell, ImageDataLoaders provides a set of handy class methods to define a set of datasets to be fed into a model. As the plural form of the name indicates, it contains more than one dataset which means multiple datasets such as training/validation/test could be managed in one place.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageDataLoaders</span><span class="p">(</span><span class="n">DataLoaders</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="nd">@delegates</span><span class="p">(</span><span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dblock</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_folder</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@delegates</span><span class="p">(</span><span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dblock</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_path_func</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_name_func</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_path_re</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@delegates</span><span class="p">(</span><span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dblock</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_name_re</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@delegates</span><span class="p">(</span><span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dblock</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_df</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@delegates</span><span class="p">(</span><span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dblock</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_lists</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/tutorials/images/copied_from_nb/ImageDataLoaders/from_path_func.png" alt="from_path_func">
[ ImageDataLoaders.from_path_func ]</p>
<p>The name of each class methods explains itself pretty much. However, just remember, those suffixes <strong><code>_xxx</code></strong> simply means how you would like to define labels for each data. For instance, <strong><code>from_folder</code></strong> defines labels of each data by looking up the name of folders. <strong><code>from_path_func</code></strong> provides more flexible way than <strong><code>from_folder</code></strong>. Instead of specifying the folder name, we can actually write a function to extract which part of the path name should be used for labeling.</p>
<ul>
<li>with <strong><code>from_folder</code></strong>, the directory structure should strictly follow like below (the folder name for training/validation could be changed).
<pre><code>- top_director - training
               - validation</code></pre>
</li>
<li>when the directory structure is like below, <strong><code>from_folder</code></strong> can't be used. But you could parse the part of path name to be used as labels via <strong><code>from_path_func</code></strong>.
<pre><code>- top_directory - training - training
                - validation - validation</code></pre>
<ul>
<li>this examples looks silly, but you will soon realize there are many datasets structured in this way. You could either move the files into the parent directory or just simply use <strong><code>from_path_func</code></strong>.</li>
</ul>
</li>
</ul>
<p>Another cool method is <strong><code>from_path_re</code></strong>. It lets you to define labels by leveraging the power of regular expression. Even though you could implement your own regex paring logic in <strong><code>from_path_func</code></strong>, you could avoid from somewhat annoying boilerplates to set up regex with <strong><code>from_path_re</code></strong>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Each-methods">
<a class="anchor" href="#Each-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Each methods<a class="anchor-link" href="#Each-methods"> </a>
</h3>
<p>This cell provides a complete description of each class methods scrapped from the official document.</p>
<ul>
<li>
<strong>from_folder(...)</strong><ul>
<li>Create from imagenet style dataset in <code>path</code> with <code>train</code> and <code>valid</code> subfolders (or provide <code>valid_pct</code>)</li>
</ul>
</li>
<li>
<strong>from_path_func(...)</strong><ul>
<li>Create from list of <code>fnames</code> in <code>path</code>s with <code>label_func</code>
</li>
</ul>
</li>
<li>
<strong>from_name_func(...)</strong><ul>
<li>Create from the name attrs of <code>fnames</code> in <code>path</code>s with <code>label_func</code>
</li>
</ul>
</li>
<li>
<strong>from_path_re(...)</strong><ul>
<li>Create from list of <code>fnames</code> in <code>path</code>s with re expression <code>pat</code>
</li>
</ul>
</li>
<li>
<strong>from_name_re(...)</strong><ul>
<li>Create from the name attrs of <code>fnames</code> in <code>path</code>s with re expression <code>pat</code>
</li>
</ul>
</li>
<li>
<strong>from_df(...)</strong><ul>
<li>Create from <code>df</code> using <code>fn_col</code> and <code>label_col</code>
</li>
</ul>
</li>
<li>
<strong>from_csv(...)</strong><ul>
<li>Create from <code>path/csv_fname</code> using <code>fn_col</code> and <code>label_col</code>
</li>
</ul>
</li>
<li>
<strong>from_lists(...)</strong><ul>
<li>Create from list of <code>fnames</code> and <code>labels</code> in <code>path</code>
</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example-usage-with-from_path_func">
<a class="anchor" href="#Example-usage-with-from_path_func" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example usage with <code>from_path_func</code><a class="anchor-link" href="#Example-usage-with-from_path_func"> </a>
</h3>
<p>The example below is borrowed from <a href="https://docs.fast.ai/vision.data.html#ImageDataLoaders.from_path_func">fastai official document</a>.</p>
<div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">'top directory'</span>
<span class="n">fnames</span> <span class="o">=</span> <span class="s1">'list of files'</span>

<span class="k">def</span> <span class="nf">label_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span>

<span class="n">dls</span> <span class="o">=</span> <span class="n">ImageDataLoaders</span><span class="o">.</span><span class="n">from_path_func</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span>
                                      <span class="n">fnames</span> <span class="o">=</span> <span class="n">fnames</span><span class="p">,</span> 
                                      <span class="n">label_func</span> <span class="o">=</span> <span class="n">label_func</span><span class="p">)</span>
</pre></div>
<p><strong><code>from_path_func</code></strong> takes three parameters. The <strong><code>path</code></strong> is the path of the root directory of the project. <strong><code>fnames</code></strong> is a list containing all data files. It doesn't matter to include files stored in different sub-directories. Which file should belong to which label is determined via <strong><code>1abel_func</code></strong> function .</p>
<p>Let's look inside the <strong><code>label_func</code></strong> function. It is clear that it returns the name of the parent directory. For instance, if the path of a file is like <strong><code>datasets/train/image1.png</code></strong>, the label func will return <strong><code>train</code></strong> as the label for the <strong><code>image1.png</code></strong>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Let's-look-inside-one-of-them,-from_folder(...)">
<a class="anchor" href="#Let's-look-inside-one-of-them,-from_folder(...)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Let's look inside one of them, <code>from_folder(...)</code><a class="anchor-link" href="#Let's-look-inside-one-of-them,-from_folder(...)"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
    <span class="nd">@delegates</span><span class="p">(</span><span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dblock</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_folder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> 
                    <span class="n">train</span><span class="o">=</span><span class="s1">'train'</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="s1">'valid'</span><span class="p">,</span> 
                    <span class="n">valid_pct</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                    <span class="n">item_tfms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_tfms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">splitter</span> <span class="o">=</span> <span class="n">GrandparentSplitter</span><span class="p">(</span><span class="n">train_name</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">valid_name</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span> \
                   <span class="k">if</span> <span class="n">valid_pct</span> <span class="ow">is</span> <span class="kc">None</span> \
                   <span class="k">else</span> <span class="n">RandomSplitter</span><span class="p">(</span><span class="n">valid_pct</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

        <span class="n">get_items</span> <span class="o">=</span> <span class="n">get_image_files</span> \
                    <span class="k">if</span> <span class="n">valid_pct</span> \
                    <span class="k">else</span> <span class="n">partial</span><span class="p">(</span><span class="n">get_image_files</span><span class="p">,</span> <span class="n">folders</span><span class="o">=</span><span class="p">[</span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">])</span>

        <span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="p">(</span><span class="n">ImageBlock</span><span class="p">,</span> <span class="n">CategoryBlock</span><span class="p">(</span><span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">)),</span>
                           <span class="n">get_items</span><span class="o">=</span><span class="n">get_items</span><span class="p">,</span>
                           <span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span>
                           <span class="n">get_y</span><span class="o">=</span><span class="n">parent_label</span><span class="p">,</span>
                           <span class="n">item_tfms</span><span class="o">=</span><span class="n">item_tfms</span><span class="p">,</span>
                           <span class="n">batch_tfms</span><span class="o">=</span><span class="n">batch_tfms</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dblock</span><span class="p">(</span><span class="n">dblock</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="GrandparentSplitter-function">
<a class="anchor" href="#GrandparentSplitter-function" aria-hidden="true"><span class="octicon octicon-link"></span></a>GrandparentSplitter function<a class="anchor-link" href="#GrandparentSplitter-function"> </a>
</h3>
<p><img src="/tutorials/images/copied_from_nb/ImageDataLoaders/grandparentsplitter.png" alt="grandparent splitter">
[ what does GrandparentSplitter really returns? ]</p>
<p><strong><code>GrandparentSplitter</code></strong> is a function that returns diffrent function. It's like you call a function, then you get another function from that call. The returning function is defined as <strong><code>_inner</code></strong>, but when you assign the returning function to a variable, that variable's name becomes the actual function name.</p>
<div class="highlight"><pre><span></span><span class="n">my_func</span> <span class="o">=</span> <span class="n">GrandparentSplitter</span><span class="p">()</span>
<span class="n">my_func</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
<p>In the above example code, even though the defined function name is <strong><code>_inner</code></strong>, the variable name, <strong><code>my_func</code></strong> delegates the function <strong><code>_inner</code></strong>.</p>
<p>So, what <strong><code>GrandparentSplitter</code></strong> really does is to return another function. I will call it as <strong><code>G._inner</code></strong> for convinience. So, the real question gets down to what's the job of <strong><code>G._inner</code></strong> function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_grandparent_idxs</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span> 
        <span class="k">return</span> <span class="n">mask2idxs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">items</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">L</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_inner</span><span class="p">(</span><span class="n">items</span><span class="p">,</span><span class="n">n</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">GrandparentSplitter</span><span class="p">(</span><span class="n">train_name</span><span class="o">=</span><span class="s1">'train'</span><span class="p">,</span> <span class="n">valid_name</span><span class="o">=</span><span class="s1">'valid'</span><span class="p">):</span>
    <span class="s2">"Split `items` from the grand parent folder names (`train_name` and `valid_name`)."</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_grandparent_idxs</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">train_name</span><span class="p">),</span><span class="n">_grandparent_idxs</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">valid_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_inner</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><code>G._inner</code></strong> takes only one argument, <strong><code>o</code></strong>. However, it uses parameters passed from <strong><code>GrandparentSplitter</code></strong> as well. That is something called as <strong><em>closer</em></strong>. If you are interested in, please search for it.</p>
<p>Don't be bothered by the argument name <strong><code>o</code></strong> in <strong><code>G._inner</code></strong>. It simply means items, and the items here means every files, trainining or validation data files are listed up together.</p>
<p>Now, <strong><code>G._inner</code></strong> returns two functions of the same type, <strong><code>_grandparent_idxs</code></strong>. Because when we call <strong><code>GrandparentSplitter</code></strong>, it will return <strong><code>G._inner</code></strong>, and when <strong><code>G._inner</code></strong> is called, it will return two <strong><code>_grandparent_idxs</code></strong> functions, the behaviour of <strong><code>_grandparent_idxs</code></strong> is what we really want to know.</p>
<p><strong>my thoughts</strong></p>
<ul>
<li>
<strong><code>GrandparentSplitter</code></strong> is nothing but a utility function to provide another function to let you grasp the list of indicies for training and validation datasets.</li>
<li>We can create our own splitter. It is quite simple.<ul>
<li>define a function</li>
<li>make sure the function returns two sets of lists</li>
<li>make sure each list contains indicies of files (not the filename or something)</li>
<li>use handy <code>mask2idx</code> function to filter which file belongs to which dataset</li>
</ul>
</li>
</ul>
<p>I should also mention about <code>mask2idx</code> function. It takes a list of booleans, and it returns a list of integers which indicate the index where the boolean value is <code>True</code>. So this is exactly what we need to get the list of indicies!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="partial(-get_image_files,-folders=[train,-valid]-)">
<a class="anchor" href="#partial(-get_image_files,-folders=%5Btrain,-valid%5D-)" aria-hidden="true"><span class="octicon octicon-link"></span></a>partial( get_image_files, folders=[train, valid] )<a class="anchor-link" href="#partial(-get_image_files,-folders=%5Btrain,-valid%5D-)"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to understand this part, you should understand what <code>partial</code> is first. <code>partial</code> is a great way to define a new function derived from an existing one by substituting values of arguments.</p>
<p>Below shows what <code>get_image_files</code> function looks like:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_image_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">folders</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">"Get image files in `path` recursively, only in `folders`, if specified."</span>
    <span class="k">return</span> <span class="n">get_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">image_extensions</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">folders</span><span class="o">=</span><span class="n">folders</span><span class="p">)</span>
</pre></div>
<p>As you can see, <code>get_image_files</code> has trhee arguments including <code>folders</code> whose default value is <code>None</code>. However, when we do <code>new_func = partial( get_image_files, folders=[train, valid] )</code> this, it returns a new form of function like</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_image_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="s2">"Get image files in `path` recursively, only in `folders`, if specified."</span>
    <span class="k">return</span> <span class="n">get_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="n">image_extensions</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">folders</span><span class="o">=</span><span class="p">[</span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">])</span>
</pre></div>
<p>From this point, we just can call <code>new_func()</code> without passing values into <code>folders</code> anymore.</p>
<p><strong>why need <code>partial</code>?</strong></p>
<ul>
<li>Remember <code>partial</code> gives you a new template of a function. It doesn't call the function with different values. Without <code>partial</code> we should explicitly call the function with specific values where we actually need to call. Lots of conditionaly statements may be required. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="get_image_files">
<a class="anchor" href="#get_image_files" aria-hidden="true"><span class="octicon octicon-link"></span></a>get_image_files<a class="anchor-link" href="#get_image_files"> </a>
</h3>
<p><code>get_image_files</code> gets all image type files under specified folders. It recursively collectes files in the sub-directories as well. The targeting image file extensions are all image types defined in <code>memetypes</code>. The following block shows what are they:</p>
<div class="highlight"><pre><span></span><span class="n">types_map</span> <span class="o">=</span> <span class="p">{</span> <span class="c1"># from Python's official source file</span>
                  <span class="c1"># https://svn.python.org/projects/python/trunk/Lib/mimetypes.py</span>
        <span class="s1">'.bmp'</span>    <span class="p">:</span> <span class="s1">'image/x-ms-bmp'</span><span class="p">,</span>
        <span class="s1">'.gif'</span>    <span class="p">:</span> <span class="s1">'image/gif'</span><span class="p">,</span>
        <span class="s1">'.ief'</span>    <span class="p">:</span> <span class="s1">'image/ief'</span><span class="p">,</span>
        <span class="s1">'.jpe'</span>    <span class="p">:</span> <span class="s1">'image/jpeg'</span><span class="p">,</span>
        <span class="s1">'.jpeg'</span>   <span class="p">:</span> <span class="s1">'image/jpeg'</span><span class="p">,</span>
        <span class="s1">'.jpg'</span>    <span class="p">:</span> <span class="s1">'image/jpeg'</span><span class="p">,</span>
        <span class="s1">'.pbm'</span>    <span class="p">:</span> <span class="s1">'image/x-portable-bitmap'</span><span class="p">,</span>
        <span class="s1">'.pgm'</span>    <span class="p">:</span> <span class="s1">'image/x-portable-graymap'</span><span class="p">,</span>
        <span class="s1">'.png'</span>    <span class="p">:</span> <span class="s1">'image/png'</span><span class="p">,</span>
        <span class="s1">'.pnm'</span>    <span class="p">:</span> <span class="s1">'image/x-portable-anymap'</span><span class="p">,</span>
        <span class="s1">'.ppm'</span>    <span class="p">:</span> <span class="s1">'image/x-portable-pixmap'</span><span class="p">,</span>
        <span class="s1">'.ras'</span>    <span class="p">:</span> <span class="s1">'image/x-cmu-raster'</span><span class="p">,</span>
        <span class="s1">'.rgb'</span>    <span class="p">:</span> <span class="s1">'image/x-rgb'</span><span class="p">,</span>
        <span class="s1">'.tif'</span>    <span class="p">:</span> <span class="s1">'image/tiff'</span><span class="p">,</span>
        <span class="s1">'.tiff'</span>   <span class="p">:</span> <span class="s1">'image/tiff'</span><span class="p">,</span>
        <span class="s1">'.xbm'</span>    <span class="p">:</span> <span class="s1">'image/x-xbitmap'</span><span class="p">,</span>
        <span class="s1">'.xpm'</span>    <span class="p">:</span> <span class="s1">'image/x-xpixmap'</span><span class="p">,</span>
        <span class="s1">'.xwd'</span>    <span class="p">:</span> <span class="s1">'image/x-xwindowdump'</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
<p>In <code>get_image_files(folders=['train', 'valid'])</code> case, it looks for every image files under <code>train</code> and <code>valid</code> folders, and return the list of identified image files.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="DataBlock">
<a class="anchor" href="#DataBlock" aria-hidden="true"><span class="octicon octicon-link"></span></a>DataBlock<a class="anchor-link" href="#DataBlock"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="@delegates-decorator">
<a class="anchor" href="#@delegates-decorator" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>@delegates</code> decorator<a class="anchor-link" href="#@delegates-decorator"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>@delegates</code> is a decorator from <code>fastcore</code> package. It delegates all the parameters/arguments from a function specified in <code>(...)</code>. It even covers <code>**kwargs</code>.</p>
<ul>
<li>If you actually print out <code>from_folder</code>, <code>**kwargs</code> things will be revealed/demystified.</li>
<li>please look at the picture below borrowed from <a href="https://fastpages.fast.ai/fastcore/">fastcore: An Underrated Python Library</a> by <a href="https://twitter.com/HamelHusain">Hamel Husain</a>
</li>
</ul>
<p><img src="/tutorials/images/copied_from_nb/ImageDataLoaders/delegates.png" alt="delegates"></p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="fast-ai-kr/tutorials"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/tutorials/image_data_loaders/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/tutorials/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/tutorials/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/tutorials/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/deep-diver" title="deep-diver"><svg class="svg-icon grey"><use xlink:href="/tutorials/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/algo_diver" title="algo_diver"><svg class="svg-icon grey"><use xlink:href="/tutorials/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
